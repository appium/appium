
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="The Appium automation project documentation">
      
      
      
        <link rel="canonical" href="https://appium.github.io/appium/docs/en/2.0/ecosystem/build-drivers/">
      
      <link rel="icon" href="../../assets/images/appium-logo.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.8">
    
    
      
        <title>Building Appium Drivers - Appium Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.644de097.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#before-you-create-your-driver" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        <aside class="md-banner md-banner--warning">
          
        </aside>
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="/" title="Appium Documentation" class="md-header__button md-logo" aria-label="Appium Documentation" data-md-component="logo">
      
  <img src="../../assets/images/appium-logo-white.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Appium Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Building Appium Drivers
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent=""  aria-hidden="true"  type="radio" name="__palette" id="__palette_1">
          
        
      </form>
    
    
      <div class="md-header__option">
        <div class="md-select">
          
          <button class="md-header__button md-icon" aria-label="Select language">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24z"/></svg>
          </button>
          <div class="md-select__inner">
            <ul class="md-select__list">
              
                <li class="md-select__item">
                  <a href="/docs/en/" hreflang="en" class="md-select__link">
                    English
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="/docs/ja/" hreflang="ja" class="md-select__link">
                    日本
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="/docs/zh/" hreflang="zh" class="md-select__link">
                    中文简体
                  </a>
                </li>
                
            </ul>
          </div>
        </div>
      </div>
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/appium/appium" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    appium/appium
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="/" title="Appium Documentation" class="md-nav__button md-logo" aria-label="Appium Documentation" data-md-component="logo">
      
  <img src="../../assets/images/appium-logo-white.png" alt="logo">

    </a>
    Appium Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/appium/appium" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    appium/appium
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Welcome
      </a>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Introduction
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Introduction" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Introduction
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1" type="checkbox" id="__nav_2_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_1">
          Intro to Appium
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Intro to Appium" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          Intro to Appium
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../intro/" class="md-nav__link">
        Overview of Appium
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../intro/drivers/" class="md-nav__link">
        Intro to Appium Drivers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../intro/clients/" class="md-nav__link">
        Intro to Appium Clients
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../intro/requirements/" class="md-nav__link">
        Appium Requirements
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../intro/history/" class="md-nav__link">
        Appium Project History
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Quickstart
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Quickstart" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Quickstart
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../quickstart/" class="md-nav__link">
        Quickstart Intro
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../quickstart/install/" class="md-nav__link">
        Install Appium
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../quickstart/uiauto2-driver/" class="md-nav__link">
        Install the UiAutomator2 Driver
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_4" type="checkbox" id="__nav_3_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_4">
          Write a Test
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Write a Test" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          Write a Test
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../quickstart/test-js/" class="md-nav__link">
        Write a Test (JS)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../quickstart/test-py/" class="md-nav__link">
        Write a Test (Python)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../quickstart/test-java/" class="md-nav__link">
        Write a Test (Java)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../quickstart/test-rb/" class="md-nav__link">
        Write a Test (Ruby)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../quickstart/next-steps/" class="md-nav__link">
        Next Steps
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          CLI Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="CLI Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          CLI Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cli/" class="md-nav__link">
        CLI Intro
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cli/args/" class="md-nav__link">
        Server CLI Args
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cli/extensions/" class="md-nav__link">
        The Extension CLI
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Guides
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Guides" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/migrating-1-to-2/" class="md-nav__link">
        Migrating from Appium 1.x to Appium 2.x
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/managing-exts/" class="md-nav__link">
        Managing Appium Drivers and Plugins
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/config/" class="md-nav__link">
        The Appium Config File
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/security/" class="md-nav__link">
        Appium Server Security
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/caps/" class="md-nav__link">
        Capabilities
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/context/" class="md-nav__link">
        The Context API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/settings/" class="md-nav__link">
        The Settings API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/execute-script-overload/" class="md-nav__link">
        Execute Script Overloads
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/event-timing/" class="md-nav__link">
        The Event Timing API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/log-filters/" class="md-nav__link">
        Log Filtering
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/grid/" class="md-nav__link">
        Appium and Selenium Grid
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Ecosystem
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Ecosystem" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Ecosystem
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        The Appium Ecosystem
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_2" type="checkbox" id="__nav_6_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6_2">
          Developing Appium Extensions
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Developing Appium Extensions" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_2">
          <span class="md-nav__icon md-icon"></span>
          Developing Appium Extensions
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Building Appium Drivers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Building Appium Drivers
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#before-you-create-your-driver" class="md-nav__link">
    Before you create your driver
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-drivers-to-reference" class="md-nav__link">
    Other drivers to reference
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-requirements-for-appium-drivers" class="md-nav__link">
    Basic requirements for Appium drivers
  </a>
  
    <nav class="md-nav" aria-label="Basic requirements for Appium drivers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nodejs-package-with-appium-extension-metadata" class="md-nav__link">
    Node.js package with Appium extension metadata
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extend-appiums-basedriver-class" class="md-nav__link">
    Extend Appium's BaseDriver class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make-your-driver-available" class="md-nav__link">
    Make your driver available
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#developing-your-driver" class="md-nav__link">
    Developing your driver
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#standard-driver-implementation-ideas" class="md-nav__link">
    Standard driver implementation ideas
  </a>
  
    <nav class="md-nav" aria-label="Standard driver implementation ideas">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#set-up-state-in-a-constructor" class="md-nav__link">
    Set up state in a constructor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define-and-validate-accepted-capabilities" class="md-nav__link">
    Define and validate accepted capabilities
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-a-session-and-read-capabilities" class="md-nav__link">
    Start a session and read capabilities
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#end-a-session" class="md-nav__link">
    End a session
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#access-capabilities-and-cli-args" class="md-nav__link">
    Access capabilities and CLI args
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implement-webdriver-commands" class="md-nav__link">
    Implement WebDriver commands
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implement-element-finding" class="md-nav__link">
    Implement element finding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define-valid-locator-strategies" class="md-nav__link">
    Define valid locator strategies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#throw-webdriver-specific-errors" class="md-nav__link">
    Throw WebDriver-specific errors
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#log-messages-to-the-appium-log" class="md-nav__link">
    Log messages to the Appium log
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#further-possibilities-for-appium-drivers" class="md-nav__link">
    Further possibilities for Appium drivers
  </a>
  
    <nav class="md-nav" aria-label="Further possibilities for Appium drivers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add-a-schema-for-custom-command-line-arguments" class="md-nav__link">
    Add a schema for custom command line arguments
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-driver-scripts" class="md-nav__link">
    Add driver scripts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#proxy-commands-to-another-webdriver-implementation" class="md-nav__link">
    Proxy commands to another WebDriver implementation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extend-the-existing-protocol-with-new-commands" class="md-nav__link">
    Extend the existing protocol with new commands
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implement-handling-of-appium-settings" class="md-nav__link">
    Implement handling of Appium settings
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make-itself-aware-of-resources-other-concurrent-drivers-are-using" class="md-nav__link">
    Make itself aware of resources other concurrent drivers are using
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#log-events-to-the-appium-event-timeline" class="md-nav__link">
    Log events to the Appium event timeline
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hide-behaviour-behind-security-flags" class="md-nav__link">
    Hide behaviour behind security flags
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-a-temp-dir-for-files" class="md-nav__link">
    Use a temp dir for files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deal-with-unexpected-shutdowns-or-crashes" class="md-nav__link">
    Deal with unexpected shutdowns or crashes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../build-plugins/" class="md-nav__link">
        Building Appium Plugins
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../build-docs/" class="md-nav__link">
        Building Docs for Appium Extensions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Contributing
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Contributing" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Contributing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        Contributing to Appium
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/config-system/" class="md-nav__link">
        Appium's Config System
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../resources/" class="md-nav__link">
        More Appium Resources
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/appium/appium/issues" class="md-nav__link">
        Issues
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#before-you-create-your-driver" class="md-nav__link">
    Before you create your driver
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-drivers-to-reference" class="md-nav__link">
    Other drivers to reference
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-requirements-for-appium-drivers" class="md-nav__link">
    Basic requirements for Appium drivers
  </a>
  
    <nav class="md-nav" aria-label="Basic requirements for Appium drivers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nodejs-package-with-appium-extension-metadata" class="md-nav__link">
    Node.js package with Appium extension metadata
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extend-appiums-basedriver-class" class="md-nav__link">
    Extend Appium's BaseDriver class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make-your-driver-available" class="md-nav__link">
    Make your driver available
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#developing-your-driver" class="md-nav__link">
    Developing your driver
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#standard-driver-implementation-ideas" class="md-nav__link">
    Standard driver implementation ideas
  </a>
  
    <nav class="md-nav" aria-label="Standard driver implementation ideas">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#set-up-state-in-a-constructor" class="md-nav__link">
    Set up state in a constructor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define-and-validate-accepted-capabilities" class="md-nav__link">
    Define and validate accepted capabilities
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-a-session-and-read-capabilities" class="md-nav__link">
    Start a session and read capabilities
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#end-a-session" class="md-nav__link">
    End a session
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#access-capabilities-and-cli-args" class="md-nav__link">
    Access capabilities and CLI args
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implement-webdriver-commands" class="md-nav__link">
    Implement WebDriver commands
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implement-element-finding" class="md-nav__link">
    Implement element finding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define-valid-locator-strategies" class="md-nav__link">
    Define valid locator strategies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#throw-webdriver-specific-errors" class="md-nav__link">
    Throw WebDriver-specific errors
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#log-messages-to-the-appium-log" class="md-nav__link">
    Log messages to the Appium log
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#further-possibilities-for-appium-drivers" class="md-nav__link">
    Further possibilities for Appium drivers
  </a>
  
    <nav class="md-nav" aria-label="Further possibilities for Appium drivers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add-a-schema-for-custom-command-line-arguments" class="md-nav__link">
    Add a schema for custom command line arguments
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-driver-scripts" class="md-nav__link">
    Add driver scripts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#proxy-commands-to-another-webdriver-implementation" class="md-nav__link">
    Proxy commands to another WebDriver implementation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extend-the-existing-protocol-with-new-commands" class="md-nav__link">
    Extend the existing protocol with new commands
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implement-handling-of-appium-settings" class="md-nav__link">
    Implement handling of Appium settings
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make-itself-aware-of-resources-other-concurrent-drivers-are-using" class="md-nav__link">
    Make itself aware of resources other concurrent drivers are using
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#log-events-to-the-appium-event-timeline" class="md-nav__link">
    Log events to the Appium event timeline
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hide-behaviour-behind-security-flags" class="md-nav__link">
    Hide behaviour behind security flags
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-a-temp-dir-for-files" class="md-nav__link">
    Use a temp dir for files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deal-with-unexpected-shutdowns-or-crashes" class="md-nav__link">
    Deal with unexpected shutdowns or crashes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/appium/appium/edit/master/packages/appium/docs/en/ecosystem/build-drivers.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>



  <h1>Building Appium Drivers</h1>

<p>Appium wants to make it easy for anyone to develop their own automation drivers as part of the
Appium ecosystem. This guide will explain what's involved and how you can accomplish various driver
development tasks using the tools Appium provides. This guide assumes you (1) are a competent user of
Appium, (2) are a competent Node.js developer, and (3) that you have read and understood the
<a href="../../intro/drivers/">Driver Intro</a>.</p>
<p>If that describes you, great! This guide will get you started.</p>
<h2 id="before-you-create-your-driver">Before you create your driver</h2>
<p>Before you get to work implementing your driver, it's important to have a few things sorted out.
For example, you need to know what your driver will do. Which platform is it trying to expose
WebDriver automation for?</p>
<p>Appium doesn't magically give you the power to automate any platform. All it does is give you a set
of convenient tools for implementing the WebDriver Protocol. So if you want to create, for example,
a driver for a new app platform, you'll need to know how to automate apps on that platform <em>without Appium</em>.</p>
<p>This usually means that you need to be very familiar with app development for a given platform. And
it usually means that you will rely on tools or SDKs provided by the platform vendor.</p>
<p>Basically, if you can't answer the question <strong>"how would I launch, remotely trigger behaviours, and
read state from an app on this platform?" then you're not quite ready to write an Appium driver</strong>.
Make sure you do the research to feel comfortable that there <em>is</em> a path forward. Once there is,
coding it up and making it available as an Appium driver should be the easy part!</p>
<h2 id="other-drivers-to-reference">Other drivers to reference</h2>
<p>One of the greatest things about building an Appium driver is that there are already a number of
open source Appium drivers which you can look at for reference. There is
a <a href="https://github.com/appium/appium/tree/2.0/packages/fake-driver">fake-driver</a> sample driver which
does basically nothing other than showcase some of the things described in this guide.</p>
<p>And of course, all of Appium's official drivers are open source and available in repositories at
the project's GitHub organization. So if you ever find yourself asking, "how does a driver do X?",
read the code for these drivers! Also don't be afraid to ask questions of the Appium developers if
you get stuck; we're always happy to help make sure the driver development experience is a good
one!</p>
<h2 id="basic-requirements-for-appium-drivers">Basic requirements for Appium drivers</h2>
<p>These are the things your driver <em>must</em> do (or be), if you want it to be a valid Appium driver.</p>
<h3 id="nodejs-package-with-appium-extension-metadata">Node.js package with Appium extension metadata</h3>
<p>All Appium drivers are fundamentally Node.js packages, and therefore must have a valid
<code>package.json</code>. Your driver is not <em>limited</em> to Node.js, but it must provide an adapter written in Node.js so it can be loaded by Appium.</p>
<p>Your <code>package.json</code> must include <code>appium</code> as a <code>peerDependency</code>. The requirements for the
dependency versions should be as loose as possible (unless you happen to know your driver will only
work with certain versions of Appium). For Appium 2.0, for example, this would look something like
<code>^2.0.0</code>, declaring that your driver works with any version of Appium that starts with 2.x.</p>
<p>Your <code>package.json</code> must contain an <code>appium</code> field, like this (we call this the 'Appium extension
metadata'):</p>
<div class="highlight"><pre><span></span><code>```json
{
  ...,
  &quot;appium&quot;: {
    &quot;driverName&quot;: &quot;fake&quot;,
    &quot;automationName&quot;: &quot;Fake&quot;,
    &quot;platformNames&quot;: [
      &quot;Fake&quot;
    ],
    &quot;mainClass&quot;: &quot;FakeDriver&quot;
  },
  ...
}
```
</code></pre></div>
<p>The required subfields are:</p>
<ul>
<li><code>driverName</code>: this should be a short name for your driver.</li>
<li><code>automationName</code>: this should be the string users will use for their <code>appium:automationName</code>
  capability to tell Appium to use <em>your</em> driver.</li>
<li><code>platformNames</code>: this is an array of one or more platform names considered valid for your driver.
  When a user sends in the <code>platformName</code> capability to start a session, it must be included in
  this list for your driver to handle the session. Known platform name strings include: <code>iOS</code>,
  <code>tvOS</code>, <code>macOS</code>, <code>Windows</code>, <code>Android</code>.</li>
<li><code>mainClass</code>: this is a named export (in CommonJS style) from your <code>main</code> field. It must be a
  class which extends Appium's <code>BaseDriver</code> (see below).</li>
</ul>
<h3 id="extend-appiums-basedriver-class">Extend Appium's <code>BaseDriver</code> class</h3>
<p>Ultimately, your driver is much easier to write because most of the hard work of implementing the
WebDriver protocol and handling certain common logic is taken care of already by Appium. This is
all encoded up as a class which Appium exports for you to use, called <code>BaseDriver</code>. It is exported
from <code>appium/driver</code>, so you can use one of these styles to import it and create your <em>own</em> class
that extends it:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">import</span> <span class="p">{</span><span class="nx">BaseDriver</span><span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;appium/driver&#39;</span><span class="p">;</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="c1">// or: const {BaseDriver} = require(&#39;appium/driver&#39;);</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="k">export</span> <span class="kd">class</span> <span class="nx">MyDriver</span> <span class="k">extends</span> <span class="nx">BaseDriver</span> <span class="p">{</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="p">}</span>
</code></pre></div>
<h3 id="make-your-driver-available">Make your driver available</h3>
<p>That's basically it! With a Node.js package exporting a driver class and with correct Appium
extension metadata, you've got yourself an Appium driver! Now it doesn't <em>do</em> anything, but you can
load it up in Appium, start and stop sessions with it, etc...</p>
<p>To make it available to users, you could publish it via NPM. When you do so, your driver will be
installable via the Appium CLI:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>appium driver install --source=npm &lt;driver-package-on-npm&gt;
</code></pre></div>
<p>It's a good idea to test your driver first, of course. One way to see how it works within Appium is
to install it locally first:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>appium driver install --source=local /path/to/your/driver
</code></pre></div>
<h3 id="developing-your-driver">Developing your driver</h3>
<p>How you develop your driver is up to you. It is convenient, however, to run it from within Appium
without having to do lots of publishing and installing. The most straightforward way to do this is
to include the most recent version of Appium as a <code>devDependency</code>, and then also your own driver,
like this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="p">{</span><span class="w"></span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">    </span><span class="nt">&quot;devDependencies&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">        </span><span class="err">...</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">        </span><span class="nt">&quot;appium&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^2.0.0&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">        </span><span class="nt">&quot;your-driver&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;file:.&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">        </span><span class="err">...</span><span class="w"></span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Now, you can run Appium locally (<code>npm exec appium</code> or <code>npx appium</code>), and because your driver is
listed as a dependency alongside it, it will be automatically "installed" and available. You can
design your e2e tests this way, or if you're writing them in Node.js, you can simply import
Appium's start server methods to handle starting and stopping the Appium server in Node. (TODO:
reference an implementation of this in one of the open source drivers when ready).</p>
<p>Another way to do local development with an existing Appium server install is to simply install
your driver locally:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>appium driver install --source=local /path/to/your/driver/dev/dir
</code></pre></div>
<h2 id="standard-driver-implementation-ideas">Standard driver implementation ideas</h2>
<p>These are things you will probably find yourself wanting to do when creating a driver.</p>
<h3 id="set-up-state-in-a-constructor">Set up state in a constructor</h3>
<p>If you define your own constructor, you'll need to call <code>super</code> to make sure all the standard state
is set up correctly:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="kr">constructor</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>    <span class="k">super</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>    <span class="c1">// now do your own thing</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="p">}</span>
</code></pre></div>
<p>The <code>args</code> parameter here is the object containing all the CLI args used to start the Appium
server.</p>
<h3 id="define-and-validate-accepted-capabilities">Define and validate accepted capabilities</h3>
<p>You can define your own capabilities and basic validation for them. Users will always be able to
send in capabilities that you don't define, but if they send in capabilities you have explicitly
defined, then Appium will validate that they are of the correct type (and will check for the
presence of required capabilities).</p>
<p>If you want to turn capability validation off entirely, set <code>this.shouldValidateCaps</code> to <code>false</code> in
your constructor.</p>
<p>To give Appium your validation constraints, set <code>this.desiredCapConstraints</code> to a validation object
in your constructor. Validation objects can be somewhat complex. Here's an example from the
UiAutomator2 driver:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="p">{</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>  <span class="nx">app</span><span class="o">:</span> <span class="p">{</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>    <span class="nx">presence</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>    <span class="nx">isString</span><span class="o">:</span> <span class="kc">true</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>  <span class="p">},</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>  <span class="nx">automationName</span><span class="o">:</span> <span class="p">{</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>    <span class="nx">isString</span><span class="o">:</span> <span class="kc">true</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>  <span class="p">},</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>  <span class="nx">browserName</span><span class="o">:</span> <span class="p">{</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>    <span class="nx">isString</span><span class="o">:</span> <span class="kc">true</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>  <span class="p">},</span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>  <span class="nx">launchTimeout</span><span class="o">:</span> <span class="p">{</span>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>    <span class="nx">isNumber</span><span class="o">:</span> <span class="kc">true</span>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>  <span class="p">},</span>
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="p">}</span>
</code></pre></div>
<h3 id="start-a-session-and-read-capabilities">Start a session and read capabilities</h3>
<p>Appium's <code>BaseDriver</code> already implements the <code>createSession</code> command, so you don't have to. However
it's very common to need to perform your own startup actions (launching an app, running some
platform code, or doing different things based on capabilities you have defined for your driver).
So you'll probably end up overriding <code>createSession</code>. You can do so by defining the method in your
driver:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="k">async</span> <span class="nx">createSession</span><span class="p">(</span><span class="nx">jwpCaps</span><span class="p">,</span> <span class="nx">reqCaps</span><span class="p">,</span> <span class="nx">w3cCaps</span><span class="p">,</span> <span class="nx">otherDriverData</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>    <span class="kd">const</span> <span class="p">[</span><span class="nx">sessionId</span><span class="p">,</span> <span class="nx">caps</span><span class="p">]</span> <span class="o">=</span> <span class="k">super</span><span class="p">.</span><span class="nx">createSession</span><span class="p">(</span><span class="nx">w3cCaps</span><span class="p">);</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>    <span class="c1">// do your own stuff here</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>    <span class="k">return</span> <span class="p">[</span><span class="nx">sessionId</span><span class="p">,</span> <span class="nx">caps</span><span class="p">];</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="p">}</span>
</code></pre></div>
<p>For legacy reasons, your function will receive old-style JSON Wire Protocol desired and required
caps as the first two arguments. Given that the old protocol isn't supported anymore and clients
have all been updated, you can instead only rely on the <code>w3cCaps</code> parameter. (For a discussion
about what <code>otherDriverData</code> is about, see the section below on concurrent drivers).</p>
<p>You'll want to make sure to call <code>super.createSession</code> in order to get the session ID as well as
the processed capabilities (note that capabilities are also set on <code>this.caps</code>; modifying <code>caps</code>
locally here would have no effect other than changing what the user sees in the create session
response).</p>
<p>So that's it! You can fill out the middle section with whatever startup logic your driver requires.</p>
<h3 id="end-a-session">End a session</h3>
<p>If your driver requires any cleanup or shutdown logic, it's best to do it as part of overriding the
implementation of <code>deleteSession</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="k">async</span> <span class="nx">deleteSession</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>    <span class="c1">// do your own cleanup here</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>    <span class="c1">// don&#39;t forget to call super!</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>    <span class="k">await</span> <span class="k">super</span><span class="p">.</span><span class="nx">deleteSession</span><span class="p">();</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="p">}</span>
</code></pre></div>
<p>It's very important not to throw any errors here if possible so that all parts of session cleanup
can succeed!</p>
<h3 id="access-capabilities-and-cli-args">Access capabilities and CLI args</h3>
<p>You'll often want to read parameters the user has set for the session, whether as CLI args or as
capabilities. The easiest way to do this is to access <code>this.opts</code>, which is a merge of all options,
from the CLI or from capabilities. So for example to access the <code>appium:app</code> capability, you could
simply get the value of <code>this.opts.app</code>.</p>
<p>If you care about knowing whether something was sent in as a CLI arg <em>or</em> a capability, you can
access the <code>this.cliArgs</code> and <code>this.caps</code> objects explicitly.</p>
<p>In all cases, the <code>appium:</code> capability prefix will have been stripped away by the time you are
accessing values here, for convenience.</p>
<h3 id="implement-webdriver-commands">Implement WebDriver commands</h3>
<p>You handle WebDriver commands by implementing functions in your driver class. Each member of the
WebDriver Protocol, plus the various Appium extensions, has a corresponding function that you
implement if you want to support that command in your driver. The best way to see which commands
Appium supports and which method you need to implement for each command is to look at Appium's
<a href="https://github.com/appium/appium/blob/2.0/packages/base-driver/lib/protocol/routes.js">routes.js</a>.
Each route object in this file tells you the command name as well as the parameters you'd expect to
receive for that command.</p>
<p>Let's take this block for example:
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="s1">&#39;/session/:sessionId/url&#39;</span><span class="o">:</span> <span class="p">{</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>    <span class="nx">GET</span><span class="o">:</span> <span class="p">{</span><span class="nx">command</span><span class="o">:</span> <span class="s1">&#39;getUrl&#39;</span><span class="p">},</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>    <span class="nx">POST</span><span class="o">:</span> <span class="p">{</span><span class="nx">command</span><span class="o">:</span> <span class="s1">&#39;setUrl&#39;</span><span class="p">,</span> <span class="nx">payloadParams</span><span class="o">:</span> <span class="p">{</span><span class="nx">required</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]}},</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="p">}</span>
</code></pre></div></p>
<p>Here we see that the route <code>/session/:sessionId/url</code> is mapped to two commands, one for a <code>GET</code>
request and one for a <code>POST</code> request. If we want to allow our driver to change the "url" (or
whatever that might mean for our driver), we can therefore implement the <code>setUrl</code> command, knowing
it will take the <code>url</code> parameter:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="k">async</span> <span class="nx">setUrl</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>    <span class="c1">// your implementation here</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="p">}</span>
</code></pre></div>
<p>A few notes:
- all command methods should be <code>async</code> functions or otherwise return a <code>Promise</code>
- you don't need to worry about protocol encoding/decoding. You will get JS objects as params, and
  can return JSON-serializable objects in response. Appium will take care of wrapping it up in the
  WebDriver protocol response format, turning it into JSON, etc...
- all session-based commands receive the <code>sessionId</code> parameter as the last parameter
- all element-based commands receive the <code>elementId</code> parameter as the second-to-last parameter
- if your driver doesn't implement a command, users can still try to access the command, and will
  get a <code>501 Not Yet Implemented</code> response error.</p>
<h3 id="implement-element-finding">Implement element finding</h3>
<p>Element finding is a special command implementation case. You don't actually want to override
<code>findElement</code> or <code>findElements</code>, even though those are what are listed in <code>routes.js</code>. Appium does
a lot of work for you if instead you implement this function:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="k">async</span> <span class="nx">findElOrEls</span><span class="p">(</span><span class="nx">strategy</span><span class="p">,</span> <span class="nx">selector</span><span class="p">,</span> <span class="nx">mult</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>    <span class="c1">// find your element here</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="p">}</span>
</code></pre></div>
<p>Here's what gets passed in:</p>
<ul>
<li><code>strategy</code> - a string, the locator strategy being used</li>
<li><code>selector</code> - a string, the selector</li>
<li><code>mult</code> - boolean, whether the user has requested one element or all elements matching the
  selector</li>
<li><code>context</code> - (optional) if defined, will be a W3C Element (i.e., a JS object with the W3C element
  identifier as the key and the element ID as the value)</li>
</ul>
<p>And you need to return one of the following:</p>
<ul>
<li>a single W3C element (an object as described above)</li>
<li>an array of W3C elements</li>
</ul>
<p>Note that you can import that W3C web element identifier from <code>appium/support</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="k">import</span> <span class="p">{</span><span class="nx">util</span><span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;appium/support&#39;</span><span class="p">;</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="kd">const</span> <span class="p">{</span> <span class="nx">W3C_WEB_ELEMENT_IDENTIFIER</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">util</span><span class="p">;</span>
</code></pre></div>
<p>What you do with elements is up to you! Usually you end up keeping a cache map of IDs to actual
element "objects" or whatever the equivalent is for your platform.</p>
<h3 id="define-valid-locator-strategies">Define valid locator strategies</h3>
<p>Your driver might only support a subset of the standard WebDriver locator strategies, or it might
add its own custom locator strategies. To tell Appium which strategies are considered valid for
your driver, create an array of strategies and assign it to <code>this.locatorStrategies</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="k">this</span><span class="p">.</span><span class="nx">locatorStrategies</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;xpath&#39;</span><span class="p">,</span> <span class="s1">&#39;custom-strategy&#39;</span><span class="p">];</span>
</code></pre></div>
<p>Appium will throw an error if the user attempts to use any strategies other than the allowed ones,
which enables you to keep your element finding code clean and deal with only the strategies you
know about.</p>
<p>By default, the list of valid strategies is empty, so if your driver isn't simply proxying to
another WebDriver endpoint, you'll need to define some. The protocol-standard locator strategies
are defined <a href="https://www.w3.org/TR/webdriver/#locator-strategies">here</a>.</p>
<h3 id="throw-webdriver-specific-errors">Throw WebDriver-specific errors</h3>
<p>The WebDriver spec defines a <a href="https://github.com/jlipps/simple-wd-spec#error-codes">set of error
codes</a> to accompany command responses if an
error occurred. Appium has created error classes for each of these codes, so you can throw the
appropriate error from inside a command, and it will do the right thing in terms of the protocol
response to the user. To get access to these error classes, import them from <code>appium/driver</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>import {errors} from &#39;appium/driver&#39;;
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>throw new errors.NoSuchElementError();
</code></pre></div>
<h3 id="log-messages-to-the-appium-log">Log messages to the Appium log</h3>
<p>You can always use <code>console.log</code>, of course, but Appium provides a nice logger for you as
<code>this.log</code> (it has <code>.info</code>, <code>.debug</code>, <code>.log</code>, <code>.warn</code>, <code>.error</code> methods on it for differing log
levels). If you want to create an Appium logger outside of a driver context (say in a script or
helper file), you can always construct your own too:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="k">import</span> <span class="p">{</span><span class="nx">logging</span><span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;appium/support&#39;</span><span class="p">;</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="kd">const</span> <span class="nx">log</span> <span class="o">=</span> <span class="nx">logging</span><span class="p">.</span><span class="nx">getLogger</span><span class="p">(</span><span class="s1">&#39;MyDriver&#39;</span><span class="p">);</span>
</code></pre></div>
<h2 id="further-possibilities-for-appium-drivers">Further possibilities for Appium drivers</h2>
<p>These are things your driver <em>can</em> do to take advantage of extra driver features or do its job more
conveniently.</p>
<h3 id="add-a-schema-for-custom-command-line-arguments">Add a schema for custom command line arguments</h3>
<p>You can add custom CLI args if you want your driver to receive data from the command line when the
Appium server is started (for example, ports that a server administrator should set that should not
be passed in as capabilities.</p>
<p>To define CLI arguments (or configuration properties) for the Appium server, your extension must provide a <em>schema</em>. In
the <code>appium</code> property of your extension's <code>package.json</code>, add a <code>schema</code> property. This will either
a) be a schema itself, or b) be a path to a schema file.</p>
<p>The rules for these schemas:</p>
<ul>
<li>Schemas must conform to <a href="https://ajv.js.org/json-schema.html#draft-07">JSON Schema Draft-07</a>.</li>
<li>If the <code>schema</code> property is a path to a schema file, the file must be in JSON or JS (CommonJS) format.</li>
<li>Custom <code>$id</code> values are unsupported. To use <code>$ref</code>, provide a value relative to the schema root, e.g., <code>/properties/foo</code>.</li>
<li>Known values of the <code>format</code> keyword are likely supported, but various other keywords may be unsupported. If you find a keyword that is unsupported which you need to use, please <a href="https://github.com/appium/appium/issues/new">ask for support</a> or send a PR!</li>
<li>The schema must be of type <code>object</code> (<code>{"type": "object"}</code>), containing the arguments in a <code>properties</code> keyword. Nested properties are unsupported.</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="p">{</span><span class="w"></span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="w">  </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="w">    </span><span class="nt">&quot;test-web-server-port&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;integer&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="w">      </span><span class="nt">&quot;minimum&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="w">      </span><span class="nt">&quot;maximum&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">65535</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="w">      </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;The port to use for the test web server&quot;</span><span class="w"></span>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="w">    </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="w">    </span><span class="nt">&quot;test-web-server-host&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="w">      </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;The host to use for the test web server&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="w">      </span><span class="nt">&quot;default&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sillyhost&quot;</span><span class="w"></span>
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a><span class="w">  </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>The above schema defines two properties which can be set via CLI argument or configuration file. If
this extension is a <em>driver</em> and its name is "horace", the CLI args would be
<code>--driver-horace-test-web-server-port</code> and <code>--driver-horace-test-web-server-host</code>, respectively.
Alternatively, a user could provide a configuration file containing:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="p">{</span><span class="w"></span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="w">  </span><span class="nt">&quot;server&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="w">    </span><span class="nt">&quot;driver&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="w">      </span><span class="nt">&quot;horace&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="w">        </span><span class="nt">&quot;test-web-server-port&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1234</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="w">        </span><span class="nt">&quot;test-web-server-host&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;localhorse&quot;</span><span class="w"></span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="w">      </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="w">  </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
<h3 id="add-driver-scripts">Add driver scripts</h3>
<p>Sometimes you might want users of your driver to be able to run scripts outside the context of
a session (for example, to run a script that pre-builds aspects of your driver). To support this,
you can add a map of script names and JS files to the <code>scripts</code> field within your Appium extension
metadata. So let's say you've created a script in your project that lives in a <code>scripts</code> directory
in your project, named <code>driver-prebuild.js</code>. Then you could add a <code>scripts</code> field like this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="p">{</span><span class="w"></span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="w">    </span><span class="nt">&quot;scripts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="w">        </span><span class="nt">&quot;prebuild&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./scripts/driver-prebuild.js&quot;</span><span class="w"></span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Now, assuming your driver is named <code>mydriver</code>, users of your driver can run <code>appium driver run
mydriver prebuild</code>, and your script will execute.</p>
<h3 id="proxy-commands-to-another-webdriver-implementation">Proxy commands to another WebDriver implementation</h3>
<p>A very common design architecture for Appium drivers is to have some kind of platform-specific
WebDriver implementation that the Appium driver interfaces with. For example, the Appium
UiAutomator2 driver interfaces with a special (Java-based) server running on the Android device. In
webview mode, it also interfaces with Chromedriver.</p>
<p>If you find yourself in this situation, it is extremely easy to tell Appium that your driver is
just going to be proxying WebDriver commands straight to another endpoint.</p>
<p>First, let Appium know that your driver <em>can</em> proxy by implementing the <code>canProxy</code> method:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="nx">canProxy</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="p">}</span>
</code></pre></div>
<p>Next, tell Appium which WebDriver routes it should <em>not</em> attempt to proxy (there often end up being
certain routes that you don't want to forward on):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="nx">getProxyAvoidList</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>    <span class="k">return</span> <span class="p">[</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>        <span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="ow">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;^/session/[^/]+/appium&#39;</span><span class="p">)]</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>    <span class="p">];</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="p">}</span>
</code></pre></div>
<p>The proxy avoidance list should be an array of arrays, where each inner array has an HTTP method as
its first member, and a regular expression as its second. If the regular expression matches the
route, then the route will not be proxied and instead will be handled by your driver. In this
example, we are avoiding proxying all <code>POST</code> routes that have the <code>appium</code> prefix.</p>
<p>Next, we have to set up the proxying itself. The way to do this is to use a special class from
Appium called <code>JWProxy</code>. (The name means "JSON Wire Proxy" and is related to a legacy
implementation of the protocol). You'll want to create a <code>JWProxy</code> object using the details required to
connect to the remote server:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="c1">// import {JWProxy} from &#39;appium/driver&#39;;</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="kd">const</span> <span class="nx">proxy</span> <span class="o">=</span> <span class="ow">new</span> <span class="nx">JWProxy</span><span class="p">({</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>    <span class="nx">server</span><span class="o">:</span> <span class="s1">&#39;remote.server&#39;</span><span class="p">,</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>    <span class="nx">port</span><span class="o">:</span> <span class="mf">1234</span><span class="p">,</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>    <span class="nx">base</span><span class="o">:</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="p">});</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="k">this</span><span class="p">.</span><span class="nx">proxyReqRes</span> <span class="o">=</span> <span class="nx">proxy</span><span class="p">.</span><span class="nx">proxyReqRes</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">proxy</span><span class="p">);</span>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="k">this</span><span class="p">.</span><span class="nx">proxyCommand</span> <span class="o">=</span> <span class="nx">proxy</span><span class="p">.</span><span class="nx">command</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">proxy</span><span class="p">);</span>
</code></pre></div>
<p>Here we are creating a proxy object and assigning some of its methods to <code>this</code> under the names
<code>proxyReqRes</code> and <code>proxyCommand</code>. This is required for Appium to use the proxy, so don't forget
this step! The <code>JWProxy</code> has a variety of other options which you can check out in the source code,
as well. (TODO: publish options as API docs and link here).</p>
<p>Finally, we need a way to tell Appium when the proxy is active. For your driver it might always
be active, or it might only be active when in a certain context. You can define the logic as an
implementation of <code>proxyActive</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="nx">proxyActive</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span> <span class="c1">// or use custom logic</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="p">}</span>
</code></pre></div>
<p>With those pieces in play, you won't have to reimplement anything that's already implemented by the
remote endpoint you're proxying to. Appium will take care of all the proxying for you.</p>
<h3 id="extend-the-existing-protocol-with-new-commands">Extend the existing protocol with new commands</h3>
<p>You may find that the existing commands don't cut it for your driver. If you want to expose
behaviours that don't map to any of the existing commands, you can create new commands in one of
two ways:</p>
<ol>
<li>Extending the WebDriver protocol and creating client-side plugins to access the extensions</li>
<li>Overloading the Execute Script command by defining "Execute Methods"</li>
</ol>
<p>If you want to follow the first path, you can direct Appium to recognize new methods and add them
to its set of allowed HTTP routes and command names. You do this by assigning the <code>newMethodMap</code>
static variable in your driver class to an object of the same form as Appium's <code>routes.js</code> object.
For example, here is the <code>newMethodMap</code> for the <code>FakeDriver</code> example driver:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="k">static</span> <span class="nx">newMethodMap</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>  <span class="s1">&#39;/session/:sessionId/fakedriver&#39;</span><span class="o">:</span> <span class="p">{</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>    <span class="nx">GET</span><span class="o">:</span> <span class="p">{</span><span class="nx">command</span><span class="o">:</span> <span class="s1">&#39;getFakeThing&#39;</span><span class="p">},</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>    <span class="nx">POST</span><span class="o">:</span> <span class="p">{</span><span class="nx">command</span><span class="o">:</span> <span class="s1">&#39;setFakeThing&#39;</span><span class="p">,</span> <span class="nx">payloadParams</span><span class="o">:</span> <span class="p">{</span><span class="nx">required</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;thing&#39;</span><span class="p">]}},</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>  <span class="p">},</span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>  <span class="s1">&#39;/session/:sessionId/fakedriverargs&#39;</span><span class="o">:</span> <span class="p">{</span>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>    <span class="nx">GET</span><span class="o">:</span> <span class="p">{</span><span class="nx">command</span><span class="o">:</span> <span class="s1">&#39;getFakeDriverArgs&#39;</span><span class="p">},</span>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>  <span class="p">},</span>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="p">};</span>
</code></pre></div>
<p>In this example we're adding a few new routes and a total of 3 new commands. For more examples of
how to define commands in this way, it's best to have a look through <code>routes.js</code>. Now all you need
to do is implement the command handlers in the same way you'd implement any other Appium command.</p>
<p>The downside of this way of adding new commands is that people using the standard Appium clients
won't have nice client-side functions designed to target these endpoints. So you would need to
create and release client-side plugins for each language you want to support (directions or
examples can be found at the relevant client docs).</p>
<p>An alternative to this way of doing things is to overload a command which all WebDriver clients
have access to already: Execute Script. Appium provides some a convenient tool for making this
easy. Let's say you are building a driver for stereo system called <code>soundz</code>, and you wanted to
create a command for playing a song by name. You could expose this to your users in such a way that
they call something like:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="c1">// webdriverio example. Calling webdriverio&#39;s `executeScript` command is what trigger&#39;s Appium&#39;s</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="c1">// Execute Script command handler</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="nx">driver</span><span class="p">.</span><span class="nx">executeScript</span><span class="p">(</span><span class="s1">&#39;soundz: playSong&#39;</span><span class="p">,</span> <span class="p">[{</span><span class="nx">song</span><span class="o">:</span> <span class="s1">&#39;Stairway to Heaven&#39;</span><span class="p">,</span> <span class="nx">artist</span><span class="o">:</span> <span class="s1">&#39;Led Zeppelin&#39;</span><span class="p">}]);</span>
</code></pre></div>
<p>Then in your driver code you can define the static property <code>executeMethodMap</code> as a mapping of
script names to methods on your driver. It has the same basic form as <code>newMethodMap</code>, described
above. Once <code>executeMethodMap</code> is defined, you'll also need to implement the Execute Script command
handler, which according to Appium's routes mapping is called <code>execute</code>. The implementation can
call a single helper function, <code>this.executeMethod</code>, which takes care of looking at the script and
arguments the user sent in and routing it to the correct custom handler you've defined. Here's an
example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="k">static</span> <span class="nx">executeMethodMap</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>  <span class="s1">&#39;soundz: playSong&#39;</span><span class="p">,</span> <span class="p">{</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>    <span class="nx">command</span><span class="o">:</span> <span class="s1">&#39;soundzPlaySong&#39;</span><span class="p">,</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>    <span class="nx">params</span><span class="o">:</span> <span class="p">{</span><span class="nx">required</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;song&#39;</span><span class="p">,</span> <span class="s1">&#39;artist&#39;</span><span class="p">],</span> <span class="nx">optional</span><span class="o">:</span> <span class="p">[]},</span>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>  <span class="p">}</span>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="p">}</span>
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="k">async</span> <span class="nx">soundzPlaySong</span><span class="p">(</span><span class="nx">song</span><span class="p">,</span> <span class="nx">artist</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>  <span class="c1">// play the song based on song and artist details</span>
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a><span class="p">}</span>
<a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a>
<a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a><span class="k">async</span> <span class="nx">execute</span><span class="p">(</span><span class="nx">script</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a>  <span class="k">return</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">executeMethod</span><span class="p">(</span><span class="nx">script</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
<a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a><span class="p">}</span>
</code></pre></div>
<p>A couple notes about this system:
1. The arguments array sent via the call to Execute Script must contain only zero or one element(s). The
   first item in the list is considered to be the parameters object for your method. These parameters
   will be parsed, validated, and then applied to your overload method in the order specified in
   <code>executeMethodMap</code> (the order specified in the <code>required</code> parameters list, followed by the
   <code>optional</code> parameters list). I.e., this framework assumes only a single actual argument sent in via
   Execute Script (and this argument should be an object with keys/values representing the
   parameters your execute method expects).
1. Appium does not automatically implement <code>execute</code> (the Execute Script handler) for you. You may
   wish, for example, to only call the <code>executeMethod</code> helper function when you're not in proxy
   mode!
1. The <code>executeMethod</code> helper will reject with an error if a script name doesn't match one of the
   script names defined as a command in <code>executeMethodMap</code>, or if there are missing parameters.</p>
<h3 id="implement-handling-of-appium-settings">Implement handling of Appium settings</h3>
<p>Appium users can send parameters to your driver via CLI args as well as via capabilities. But these
cannot change during the course of a test, and sometimes users want to adjust parameters mid-test.
Appium has a <a href="../../guides/settings/">Settings</a> API for this purpose.</p>
<p>To support settings in your own driver, first of all define <code>this.settings</code> to be an instance of
the appropriate class, in your constructor:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="c1">// import {DeviceSettings} from &#39;appium/driver&#39;;</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="k">this</span><span class="p">.</span><span class="nx">settings</span> <span class="o">=</span> <span class="ow">new</span> <span class="nx">DeviceSettings</span><span class="p">();</span>
</code></pre></div>
<p>Now, you can read user settings any time simply by calling <code>this.settings.getSettings()</code>. This will
return a JS object where the settings names are keys and have their corresponding values.</p>
<p>If you want to assign some default settings, or run some code on your end whenever settings are
updated, you can do both of these things as well.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="kr">constructor</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>  <span class="kd">const</span> <span class="nx">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="nx">setting1</span><span class="o">:</span> <span class="s1">&#39;value1&#39;</span><span class="p">};</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>  <span class="k">this</span><span class="p">.</span><span class="nx">settings</span> <span class="o">=</span> <span class="ow">new</span> <span class="nx">DeviceSettings</span><span class="p">(</span><span class="nx">defaults</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">onSettingsUpdate</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="p">}</span>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="k">async</span> <span class="nx">onSettingsUpdate</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>  <span class="c1">// do anything you want here with key and value</span>
<a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="p">}</span>
</code></pre></div>
<h3 id="make-itself-aware-of-resources-other-concurrent-drivers-are-using">Make itself aware of resources other concurrent drivers are using</h3>
<p>Let's say your driver uses up some system resources, like ports. There are a few ways to make sure
that multiple simultaneous sessions don't use the same resources:</p>
<ol>
<li>Have your users specify resource IDs via capabilities (<code>appium:driverPort</code> etc)</li>
<li>Just always use free resources (find a new random port for each session)</li>
<li>Have each driver express what resources it is using, then examine currently-used resources from
   other drivers when a new session begins.</li>
</ol>
<p>To support this third strategy, you can implement <code>get driverData</code> in your driver to return what
sorts of resources your driver is currently using, for example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="nx">get</span> <span class="nx">driverData</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>  <span class="k">return</span> <span class="p">{</span><span class="nx">specialPort</span><span class="o">:</span> <span class="mf">1234</span><span class="p">,</span> <span class="nx">specialFile</span><span class="o">:</span> <span class="err">/path/to/file}</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="p">}</span>
</code></pre></div>
<p>Now, when a new session is started on your driver, the <code>driverData</code> response from any other
simultaneously running drivers (of the same type) will also be included, as the last parameter of
the <code>createSession</code> method:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="k">async</span> <span class="nx">createSession</span><span class="p">(</span><span class="nx">jwpCaps</span><span class="p">,</span> <span class="nx">reqCaps</span><span class="p">,</span> <span class="nx">w3cCaps</span><span class="p">,</span> <span class="nx">driverData</span><span class="p">)</span>
</code></pre></div>
<p>You can dig into this <code>driverData</code> array to see what resources other drivers are using to help
determine which ones you want to use for this particular session.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Be careful here, since <code>driverData</code> is only passed between sessions of a single running Appium
server. There's nothing to stop a user from running multiple Appium servers and requesting your
driver simultaneously on each of them. In this case, you won't be able to ensure independence
of resources via <code>driverData</code>, so you might consider using file-based locking mechanisms or
something similar.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>It's also important to note you will only receive <code>driverData</code> for other instances of <em>your</em>
driver. So unrelated drivers also running may still be using some system resources. In general
Appium doesn't provide any features for ensuring unrelated drivers don't interfere with one
another, so it's up to the drivers to allow users to specify resource locations or addresses to
avoid clashes.</p>
</div>
<h3 id="log-events-to-the-appium-event-timeline">Log events to the Appium event timeline</h3>
<p>Appium has an <a href="../../guides/event-timing/">Event Timing API</a> which allows users to get timestamps
for certain server-side events (like commands, startup milestones, etc...) and display them on
a timeline. The feature basically exists to allow introspection of timing for internal events to
help with debugging or running analysis on Appium driver internals. You can add your own events to
the event log:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="k">this</span><span class="p">.</span><span class="nx">logEvent</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
</code></pre></div>
<p>Simply provide a name for the event and it will be added at the current time, and made accessible
as part of the event log for users.</p>
<h3 id="hide-behaviour-behind-security-flags">Hide behaviour behind security flags</h3>
<p>Appium has a feature-flag based <a href="../../guides/security/">security model</a> that allows driver authors
to hide certain features behind security flags. What this means is that if you have a feature you
deem insecure and want to require server admins to opt in to it, you can require that they enable
the feature by adding it to the <code>--allow-insecure</code> list or turning off server security entirely.</p>
<p>To support the check within your own driver, you can call <code>this.isFeatureEnabled(featureName)</code> to
determine whether a feature of the given name has been enabled. Or, if you want to simply
short-circuit and throw an error if the feature isn't enabled, you can call
<code>this.assertFeatureEnabled(featureName)</code>.</p>
<h3 id="use-a-temp-dir-for-files">Use a temp dir for files</h3>
<p>If you want to use a temporary directory for files your driver creates that are not important to
keep around between computer or server restarts, you can simply read from <code>this.opts.tmpDir</code>. This
reads the temporary directory location from <code>@appium/support</code>, potentially overridden by a CLI
flag. I.e., it's safer than writing to your own temporary directory because the location here plays
nicely with possible user configuration. <code>this.opts.tmpDir</code> is a string, the path to the dir.</p>
<h3 id="deal-with-unexpected-shutdowns-or-crashes">Deal with unexpected shutdowns or crashes</h3>
<p>Your driver might run into a situation where it can't continue operating normally. For example, it
might detect that some external service has crashed and nothing will work anymore. In this case, it
can call <code>this.startUnexpectedShutdown(err)</code> with an error object including any details, and Appium
will attempt to gracefully handle any remaining requests before shutting down the session.</p>
<p>If you want to perform some of your own cleanup logic when you encounter this condition, you can
either do so immediately before calling <code>this.startUnexpectedShutdown</code>, or you can attach a handler
to the unexpected shutdown event and run your cleanup logic "out of band" so to speak:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="k">this</span><span class="p">.</span><span class="nx">onUnexpectedShutdown</span><span class="p">(</span><span class="nx">handler</span><span class="p">)</span>
</code></pre></div>
<p><code>handler</code> should be a function which receives an error object (representing the reason for the
unexpected shutdown).</p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../" class="md-footer__link md-footer__link--prev" aria-label="Previous: The Appium Ecosystem" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              The Appium Ecosystem
            </div>
          </div>
        </a>
      
      
        
        <a href="../build-plugins/" class="md-footer__link md-footer__link--next" aria-label="Next: Building Appium Plugins" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Building Appium Plugins
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2012 - 2022 OpenJS Foundation
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://twitter.com/AppiumDevs" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.sections"], "search": "../../assets/javascripts/workers/search.5e67fbfe.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c44cc438.min.js"></script>
      
    
  </body>
</html>